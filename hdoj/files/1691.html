<!DOCTYPE html><html><head><link rel="stylesheet" type=text/css href="../style.css" /><title>Problem 1691</title></head><body><div id="content"><tr><td align=center><h1 style='color:#1A5CC8'>Chinese Chess</h1><font><b><span style='font-family:Arial;font-size:12px;font-weight:bold;color:green'>Time Limit: 2000/1000 MS (Java/Others)&nbsp;&nbsp;&nbsp;&nbsp;Memory Limit: 32768/32768 K (Java/Others)<br>Total Submission(s): 500&nbsp;&nbsp;&nbsp;&nbsp;Accepted Submission(s): 134<br></span></b></font><br><br><div class=panel_title align=left>Problem Description</div> <div class=panel_content>Chinese chess, or Xiangqi is an extremely popular game in the Eastern Hemisphere. It is currently played by millions (or tens of millions) in China's mainland, Taiwan, Thailand, Singapore, Vietnam, Hong Kong and other Asian countries. Chinese chess has remained in its present form for centuries.<br>The name Chinese chess has an interesting origin. Of China's four traditional arts -- qin (music), qi (strategy games), shu (calligraphy) and hua (brush painting) -- the second term, qi, provides the final syllable of Chinese chess.<br><br>Here¡¯s some more information about Chinese chess.<br><br><b>Chinese chess Board</b><br><br><img src=../../../data/images/C116-1003-1.JPG><br><br><b>Pieces</b><br>Each player has the following pieces: <br>2 Rooks (R) (or chariots) <br>2 Knights (N) (or horses) <br>2 Elephants (M) (or bishops or ministers) <br>2 Mandarins (G) (or advisors or assistants or guards) <br>1 King (K) (or generals) <br>2 Cannons (C)   <br>5 Pawns (P) (or soldiers) <br><br><img src=../../../data/images/C116-1003-2.JPG><br><br><b>Rules</b><br>a) The object of the game is to checkmate or stalemate the opponent. This is accomplished by: <br>Placing the opponent in check so that he has no legal move to get out of the check. <br>Stalemating your opponent so that he has no legal move (when you stalemate your opponent, you win--it is not a draw as in chess). <br>b) Red usually moves first. <br>c) You cannot check your opponent indefinitely by moving the same piece to the same squares (resulting in perpetual check and a draw in chess). You cannot put the opponent in check more than 3 times in a row with the same piece without either side moving any other piece. <br>d) Similar to the rule above, you cannot indefinitely &quot;chase&quot; an opposing piece from one square to another if your opponent has no other way to avoid losing the piece. The idea of this rule and the rule above is to avoid perpetual check draws. Some of these situations can be complicated but usually the person who is initiating the perpetual move loop must break it off. <br>e) The two kings cannot face each other on the same column without any pieces between them.<br>f) When neither side can capture the opposing king, the game is a draw. <br><br><br>Now your group is developing a Chinese chess software. It¡¯s your task to write a program to check if the moves are legal or not. To simplify this problem, you needn¡¯t to consider the rule b, c, d, f. It means that the result is not important. The only thing you need to do is to judge if the moves are legal. A move is illegal if:<br>a)&nbsp;&nbsp;The given coordinates of original and final position are illegal. Such as the position is out of the board, the original position is empty or your opponent¡¯s piece or the final position is your own piece.<br>b)&nbsp;&nbsp;The move breaks the move rules and rules above (except rule b, c, d, f)<br>c)&nbsp;&nbsp;Something special, if after one move, one of the player¡¯s king has been eaten, if it's the last move, it¡¯s legal, or the next move is illegal. (look at the sample for more details)<br></div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Input</div> <div class=panel_content>&nbsp;&nbsp;The input consists of several test cases. There is a single number above all, the number of cases. There are no more than 300 cases.<br>&nbsp;&nbsp;Each case starts with the initial chess board. There are 10 rows and 9 columns. 0 represents empty point. 1, 2, 3, 4, 5, 6, 7 represent red king, mandarin, elephant, knight, rook, cannon, pawn while 8, 9, 10, 11, 12, 13, 14 represent black pieces. Then two numbers N and K ( ): n is the number of moves and if K=0 red moves first, if K=1 black moves first. Next N lines follow, each containing four integers, representing the coordinates of original position and final position. You may assume that the initial board is always legal. For more details, the board of figure 1 is:<br>12 11 10 9 8 9 10 11 12<br>0 0 0 0 0 0 0 0 0<br>0 13 0 0 0 0 0 13 0<br>14 0 14 0 14 0 14 0 14<br>0 0 0 0 0 0 0 0 0<br>0 0 0 0 0 0 0 0 0<br>7 0 7 0 7 0 7 0 7<br>0 6 0 0 0 0 0 6 0<br>0 0 0 0 0 0 0 0 0<br>5 4 3 2 1 2 3 4 5<br></div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Output</div> <div class=panel_content>If all of the moves are legal, print ¡°Legal move¡±. If step x is the first illegal move, then print ¡°Illegal move on step x¡±. If there are several moves are illegal, print the first illegal move only. Use the format in the sample.</div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Sample Input</div><div class=panel_content><pre><div style="font-family:Courier New,Courier,monospace;">3
0 0 0 9 8 0 0 0 0
0 0 0 0 9 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 11 0
0 0 0 0 0 0 0 0 0
0 0 0 0 2 0 0 0 5
0 0 0 2 1 0 0 0 0
3 1
7 8 8 6
9 9 9 6
8 6 10 5
0 0 0 0 8 0 0 0 0
0 0 0 0 7 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 14 1 0 0 0 0
1 0
2 5 1 5
0 0 0 0 8 0 0 0 0
0 0 0 0 7 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0
0 0 0 14 1 0 0 0 0
2 0
2 5 1 5
10 4 10 5</div></pre></div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Sample Output</div><div class=panel_content><pre><div style="font-family:Courier New,Courier,monospace;">Case 1: Illegal move on step 3
Case 2: Legal move
Case 3: Illegal move on step 2</div></pre></div><div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Source</div> <div class=panel_content> <a href='/search.php?field=problem&key=2008 ¡°Sunline Cup¡± National Invitational Contest&source=1&searchmode=source'> 2008 ¡°Sunline Cup¡± National Invitational Contest </a> </div> <div class=panel_bottom>&nbsp;</div><br><div class=panel_title align=left>Recommend</div> <div class=panel_content>wangye</div><div class=panel_bottom>&nbsp;</div><br><center style='font-size:15px;font-family:Arial;font-weight:bold;color:#1A5CC8'><a href='statistic.php?pid=1691'>Statistic</a>&nbsp;|&nbsp;<a href='submit.php?pid=1691'>Submit</a>&nbsp;|&nbsp;<a href="./discuss/problem/list.php?problemid=1691">Discuss</a> | <a href='note/note.php?pid=1691'>Note</a><br></td></tr></div></body></html>